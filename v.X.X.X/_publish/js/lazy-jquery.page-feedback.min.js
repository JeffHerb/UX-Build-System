function changeRating(e,t){$.cookies.del(generatePageName());var n=$(e),r=n.siblings(".vote"),i=n.siblings("a").not(".vote"),s=$("#written-feedback");n.fadeOut("slow").delay(250).remove(),r.removeClass("vote"),postRating("0","change"),i.on("click",ratingClick).animate({opacity:1,width:t},{duration:650,queue:!1}),s.is(":visible")&&s.slideUp("slow")}function addChangeRating(e,t,n){var r=$('<a id="change-link" href="#">Change</a>').on("click",function(e){e.preventDefault(),changeRating(this,t)});r.delay(500).insertAfter(e).fadeIn("fast",function(){n&&$("#written-feedback").slideDown()})}function markRating(e){var t=e.hasClass("downvote"),n=!1,r="1";actionType=$("#ratings").attr("data-type"),t&&(n=!0,r="-1"),e.addClass("vote"),otherRatingWidth=e.siblings("a").width(),e.siblings("a").off("click").animate({opacity:0,width:0},{duration:650,queue:!1,complete:addChangeRating(e,otherRatingWidth,n)}),postRating(r,actionType),t||showThanks()}function showThanks(){$("#pr-thank-you span").fadeIn("slow").delay(2500).fadeOut("slow")}function ratingClick(e){e.preventDefault(),ratingLink=$(this),ratingLink.hasClass("vote")||markRating(ratingLink)}function hideCommentShowThanks(e){$("#written-feedback").slideUp("slow",showThanks)}function writtenSubmit(e){e.preventDefault(),$("#written-feedback textarea").val()!=""&&(postComment($("#written-feedback textarea").val()),hideCommentShowThanks())}function postRating(e,t){var n="",r="",i="0",s="",o="/app/page-feedback/page-feedback.php";$('meta[name="revisionNumber"]').length&&(i=$('meta[name="revisionNumber"]').attr("content"),r+="&pageVersion="+i),$('meta[name="lastUpdated"]').length&&(s=$('meta[name="lastUpdated"]').attr("content"),r+="&pageLastUpdate="+s),n="type="+t+"&rating="+e+"&pageURL="+window.location+r;if(t=="insert")$.ajax({type:"POST",url:o,data:n}).done(function(t){$("#ratings").attr("data-key",t.substring(0,10)),createRatingCookie(e,t.substring(0,10),i,s)}).fail(function(e,t){}),$("#ratings").attr("data-type","change");else{var u=$("#ratings").attr("data-key");$.ajax({type:"POST",url:o,data:"type="+t+"&rating="+e+"&pageURL="+window.location+"&userKey="+u}).done(function(){e!="0"&&createRatingCookie(e,u,i,s)}).fail(function(e,t){})}}function postComment(e){var t=$("#ratings").attr("data-key"),n="/app/page-feedback/page-feedback.php";$.ajax({type:"POST",url:n,data:"type=comment&pageComment="+e+"&userKey="+t})}function generatePageName(){var e=window.location.pathname,t=e.substring(e.lastIndexOf("/")+1);return t==""&&(t=e.split("/"),t=t[t.length-2]+"-index"),t}function createRatingCookie(e,t,n,r){var i=new Date,s=i.getTime()+18e5.toString(),o={rating:e,userKey:t,pageVersion:n,pageLastUpdate:r,expireTime:s},u={expiresAt:i.setDate(i.getDate()+30)};$.cookies.set(generatePageName(),o,u)}function existingRating(e,t){var n=new Date;time=n.getTime(),e?ratingLink=$(".upvote"):ratingLink=$(".downvote"),$('meta[name="revisionNumber"]').attr("content")==t.pageVersion||!$('meta[name="revisionNumber"]').length&&t.pageVersion=="0"?time<parseInt(t.expireTime)?(ratingLink.addClass("vote"),initializePageRating(!1),$("#ratings").attr("data-type","change").attr("data-key",t.userKey),otherRatingWidth=ratingLink.siblings("a").width(),ratingLink.siblings("a").off("click").animate({opacity:0,width:0},{duration:0,queue:!1,complete:addChangeRating(ratingLink,otherRatingWidth,!1)}),showPageRating()):(ratingLink.addClass("vote locked").on("click",function(e){e.preventDefault()}).siblings("a").hide(),showPageRating()):($.cookies.del(generatePageName()),initializePageRating(!0))}function initializePageRating(e){var t=$("#ux-page-rating .upvote"),n=$("#ux-page-rating .downvote"),r=$("#feedBackSubmit"),i=$(".no-comment");t.on("click",ratingClick),n.on("click",ratingClick),r.on("click",writtenSubmit),i.on("click",hideCommentShowThanks),e&&showPageRating()}function showPageRating(){$("#ux-page-rating").animate({opacity:1},{duration:2e3,queue:!1})}$(document).ready(function(){if(location.protocol=="https:")$("#ux-page-rating").hide();else if($("#ux-page-rating")){var e=$.cookies.get(generatePageName()),t=!0;e?e.rating?(e.rating=="-1"&&(t=!1),existingRating(t,e)):initializePageRating(!0):initializePageRating(!0)}});